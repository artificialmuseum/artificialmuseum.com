import{ab as e,x as o,a5 as t,ac as n,$ as i}from"../vendor.js";const s=new e(0,0,0,"YXZ"),r=new o,h={type:"change"},c={type:"lock"},a={type:"unlock"},d=Math.PI/2;class m extends t{constructor(e,o){super(),this.camera=e,this.domElement=o,this.isLocked=!1,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,this._onMouseMove=l.bind(this),this._onPointerlockChange=k.bind(this),this._onPointerlockError=u.bind(this),this.connect()}connect(){this.domElement.ownerDocument.addEventListener("mousemove",this._onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this._onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this._onPointerlockError)}disconnect(){this.domElement.ownerDocument.removeEventListener("mousemove",this._onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this._onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this._onPointerlockError)}dispose(){this.disconnect()}getObject(){return this.camera}getDirection(e){return e.set(0,0,-1).applyQuaternion(this.camera.quaternion)}moveForward(e){const o=this.camera;r.setFromMatrixColumn(o.matrix,0),r.crossVectors(o.up,r),o.position.addScaledVector(r,e)}moveRight(e){const o=this.camera;r.setFromMatrixColumn(o.matrix,0),o.position.addScaledVector(r,e)}lock(){this.domElement.requestPointerLock()}unlock(){this.domElement.ownerDocument.exitPointerLock()}}function l(e){if(!1===this.isLocked)return;const o=e.movementX||e.mozMovementX||e.webkitMovementX||0,t=e.movementY||e.mozMovementY||e.webkitMovementY||0,n=this.camera;s.setFromQuaternion(n.quaternion),s.y-=.002*o*this.pointerSpeed,s.x-=.002*t*this.pointerSpeed,s.x=Math.max(d-this.maxPolarAngle,Math.min(d-this.minPolarAngle,s.x)),n.quaternion.setFromEuler(s),this.dispatchEvent(h)}function k(){this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(c),this.isLocked=!0):(this.dispatchEvent(a),this.isLocked=!1)}function u(){}class y extends m{constructor(e,t,s){var{lookat:r={}}=s;super(e,t),this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.onLock=this.onLock.bind(this),this.onUnlock=this.onUnlock.bind(this),this.keyboard={},this.config={speed:.5,gravity:9.8},Object.entries(n).forEach((e=>{var[o,t]=e;this[o]=t}));var{x:h=0,y:c=0,z:a=0}=r,d=new o(h,c,a);e.lookAt(d),this.lockMenuPanel=i.create("div",{parent:document.body,style:{position:"fixed",left:"50%",top:"50%",fontSize:"2em",zIndex:5e10},children:[i.create("button",{style:{color:"#000",backgroundColor:"green"},innerText:"testing",on:{click:()=>this.lock()}})]}),i.on(this,"lock",this.onLock),i.on(this,"unlock",this.onUnlock),i.on(document,"keydown",this.onKeyDown,!1),i.on(document,"keyup",this.onKeyUp,!1)}onLock(){this.lockMenuPanel.style.display="none"}onUnlock(){this.lockMenuPanel.style.display="block"}onKeyDown(e){var{code:o,repeat:t}=e;t||("KeyW"!==o&&"ArrowUp"!==o||(this.keyboard.w=!0),"KeyA"!==o&&"ArrowLeft"!==o||(this.keyboard.a=!0),"KeyS"!==o&&"ArrowDown"!==o||(this.keyboard.s=!0),"KeyD"!==o&&"ArrowRight"!==o||(this.keyboard.d=!0))}onKeyUp(e){var{code:o}=e;"KeyW"!==o&&"ArrowUp"!==o||(this.keyboard.w=!1),"KeyA"!==o&&"ArrowLeft"!==o||(this.keyboard.a=!1),"KeyS"!==o&&"ArrowDown"!==o||(this.keyboard.s=!1),"KeyD"!==o&&"ArrowRight"!==o||(this.keyboard.d=!1)}unspawn(){i.remove(this.lockMenuPanel),i.off(this,"lock",this.onLock),i.off(this,"unlock",this.onUnlock),i.off(document,"keydown",this.onKeyDown,!1),i.off(document,"keyup",this.onKeyUp,!1)}update(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(this.keyboard){var{speed:o}=this.config;this.keyboard.w&&this.moveForward(o*e),this.keyboard.a&&this.moveRight(-o*e),this.keyboard.s&&this.moveForward(-o*e),this.keyboard.d&&this.moveRight(o*e)}}}export{y as ArmPointerLockControls};
