var $=Object.defineProperty;var G=e=>$(e,"__esModule",{value:!0});var de=(e,t)=>{G(e);for(var o in t)$(e,o,{get:t[o],enumerable:!0})};var a=(e,t)=>typeof a[t]=="function"?a[t](e):typeof e===t;a.fn=e=>typeof e=="function";a.str=e=>typeof e=="string";a.obj=e=>typeof e=="object";a.arr=e=>Array.isArray(e);a.bool=e=>typeof e=="boolean";a.num=e=>e===+e;var S=class{constructor({W:t,type:o="session"}){try{let s=t[`${o}Storage`],r=`random-${M.random()}`;s.setItem(r,r),s.removeItem(r),this.store=s}catch{this.store={}}}setItem(t,o){let s=["setItem","getItem","removeItem"],r=s.indexOf(t);if(r>-1)throw new Error(`can not overwrite store.${s[r]}, it's a builtin`);let c=JSON.stringify(o);return this.store[t]=c,!0}getItem(t,o=void 0){return this.store.hasOwnProperty(t)?JSON.parse(this.store[t]):o}removeItem(t){a.fn(this.store.removeItem)?this.store.removeItem(t):delete this.store[t]}clear(){a.fn(this.store.clear)?this.store.clear():this.store={}}};var i=window;i.D=document;i.B=i.D.body;i.M=Math;i.NAV=i.navigator;i.UA=i.NAV.userAgent.toLowerCase()||"";i.URL=i.URL||i.webkitURL;i.store=new S({W:i,type:"session"});var n=(e,t={})=>{let{parent:o=i.D,single:s=!1}=t,r=e.split(" "),c=r[r.length-1];return s||c.startsWith("#")?o.querySelector(e):Array.from(o.querySelectorAll(e))};n.show=(e,t)=>{if(!!e){if(a.str(e)&&(e=n(e,t)),a.arr(e)){e.forEach(o=>n.show(o,t));return}e.classList&&e.classList.add("visible")}};n.hide=(e,t)=>{if(!!e){if(a.str(e)&&(e=n(e,t)),a.arr(e)){e.forEach(o=>n.hide(o,t));return}e.classList&&e.classList.remove("visible")}};n.prop=(e,t={})=>{a.str(e)&&(e=n(e)),Object.entries(t).forEach(([o,s])=>{s===!1?e.removeAttribute(o):e.setAttribute(o,s)})};n.create=(e="div",t={})=>{let{className:o,id:s,innerText:r,children:c,on:p,parent:d,style:l,...y}=t,f=i.D.createElement(e);o&&(f.className=o),r&&(f.innerText=r),c&&(a.str(c)?f.innerText+=c:a.arr(c)&&c.forEach(u=>f.appendChild(u))),l&&Object.entries(l).forEach(([u,m])=>{f.style[u]=m}),s&&f.setAttribute("id",s),p&&Object.entries(p).forEach(([u,m])=>{f.addEventListener(u,m)}),d&&n.append(f,d);let h=Object.entries(y);return h.length&&h.map(([u,m])=>{f.setAttribute(u,m)}),f};n.on=(e,t,o,s={})=>{a.str(e)&&(e=n(e)),a.arr(e)?e.forEach(r=>r.addEventListener(t,o,!1,s)):e.addEventListener(t,o,!1,s)};n.off=(e,t,o,s)=>{a.str(e)&&(e=n(e)),a.arr(e)?e.forEach(r=>r.removeEventListener(t,o,!1,s)):e.removeEventListener(t,o,!1,s)};n.append=(e,t=B)=>{a.str(e)&&(e=n(e)),a.str(t)&&(t=n(t)),t&&e&&(a.arr(e)?e.forEach(o=>t.appendChild(o)):t.appendChild(e))};n.remove=e=>{!e||(a.str(e)&&(e=n(e)),e&&e.parentNode&&e.parentNode.removeChild(e))};var g=i.UA,K=g.includes("mac")&&"ontouchend"in i.D,Y=["ipad","iphone","ipod"].some(e=>g.includes(e)),D=Y||K,Se=!D&&g.includes("macintosh"),Ae=g.includes("applewebkit")&&g.includes("safari")&&!g.includes("crios"),Q=()=>{let e;if(g.includes("chrome/")?e=g.split("chrome/")[1]:g.includes("samsungbrowser/")&&(e=g.split("samsungbrowser/")[1]),e){e=e.split(".")[0];let t=parseInt(e,10);if(a.num(t))return t}},X=Q(),Ce=a.num(X),we=g.includes("android"),je=D&&g.includes("webxrviewer");var Ie=1,Ne="map-container",U=17,A=7,Me=['<a target="_top" rel="nofollow noopener noreferrer" href="https://openstreetmap.org" title="data from openstreetmap">osm</a>','<a target="_top" rel="nofollow noopener noreferrer" href="https://leafletjs.com" title="leaflet.js map library">leaflet</a>','<a target="_top" rel="nofollow noopener noreferrer" href="https://stamen.com" title="tile design by stamen.com">stamen</a>'].join("<br>"),Oe=20,ze=500;var b=[38,38],C=[b[0]/2,b[1]/2],w=[0,b[1]/2*-1],j="map/marker",$e={location:{iconUrl(e){let t=e>0?e:1;return e>9&&(t="9-plus"),`${j}/location-${t}.svg`},iconSize:b,iconAnchor:C,popupAnchor:w},city:{iconUrl:e=>`${j}/cities/${e}.svg`,iconSize:b,iconAnchor:C,popupAnchor:w},artifact:{iconUrl:`${j}/object.svg`,iconSize:b,iconAnchor:C,popupAnchor:w}},De={strings:{title:"Click to locate yourself.",metersUnit:"meters",feetUnit:"feet",popup:"You are within {distance} {unit} from this point",outsideMapBoundsMsg:`
It seems like your Device has no gps sensors, or you declined our request to use gps.
`},locateOptions:{watch:!0,enableHighAccuracy:!0}},Be={fov:60,near:.01,far:500},Ue={maxDistance:60,minDistance:1,maxPolarAngle:Math.PI/1.9,enablePan:!1},ke={ambientColor:16777215,ambientIntensity:.5,directionalColor:16777215,directionalIntensity:2.5,directionalPosition:[15,30,7]},Re=.2,k=16,Ze=[100,60,40],He="skybox",We="3D Visualization:",_e="Sound:",Ve="three-running",Je={x:0,y:1.5,z:5},qe=(e,t="at this location.")=>(e===0?e="are no artifacts":e===1?e="is 1 artifact":e>1&&(e=`are ${e} artifacts`),`There ${e} ${t}`),Fe=10*1e3,Ge="Zoom to location",Ke="Visit City",Ye="three-audio",Qe="three-video",Xe="three-canvas",et="three-container",tt="hud",ot="hud-exit-button",st=1e4;var T=(e,t=8)=>parseFloat(e).toPrecision(t)/1;var P=()=>{};var ee=()=>i.location.hash.length>0,R=()=>new URLSearchParams(i.location.hash.substr(1)),I=()=>{let e=R(),t=e.get("z");a.num(parseInt(t,10))||e.set("z",U);let o={},s={z:"zoom",d:"detail",p:"popup",s:"screen"};for(let[r,c]of e.entries())r in s&&(r=s[r]),o[r]=c;return o},v=(e={})=>{i.STATE={...i.STATE,...e};let t=JSON.stringify(i.STATE),o=JSON.stringify(i.OLD_STATE);t!==o&&(Z(i.STATE),i.OLD_STATE=i.STATE)},Z=(e={})=>{let{detail:t,lat:o,lng:s,popup:r,screen:c,three:p,zoom:d}=e,l=R();d&&l.set("z",T(d,3)),o&&l.set("lat",T(o,A)),s&&l.set("lng",T(s,A)),r?l.set("p",r):r===!1&&l.delete("p"),t?l.set("d",t):t===!1&&l.delete("d"),c?l.set("s",c):c===!1&&l.delete("s"),p||l.delete("t"),i.location.hash=l.toString()},H=({map:e,zoom:t})=>{let{locationLayer:o,artifactLayer:s}=e;!o||(t>=k?(e.hasLayer(o)&&e.removeLayer(o),e.hasLayer(s)||e.addLayer(s)):(e.hasLayer(o)||e.addLayer(o),e.hasLayer(s)&&e.removeLayer(s)))},W=e=>{let t=n(".nav.menu");e?t.forEach(o=>{if(!o.dataset.to){o.classList.remove("active");return}let s=o.dataset.to===e||o.classList.contains(e),r=e.includes("-")&&o.classList.contains(e.split("-")[0]);s||r?o.classList.add("active"):o.classList.remove("active")}):t.forEach(o=>{o.classList.contains("map")?o.classList.add("active"):o.classList.remove("active")})},_=e=>{let t=!1;if(e==="home"&&(e="about"),n(".screen.visible").forEach(r=>{r.classList.remove("visible")}),n(`.screen[data-name=${e}]`).forEach(r=>{r.classList.add("visible"),t=!0}),e){let r;e.startsWith("list-")?r=n(".screen[data-name=list]",{single:!0}):e.startsWith("help-")&&(r=n(".screen[data-name=help]",{single:!0})),r&&(r.classList.add("visible"),t=!0)}t?(e==="about"&&i.B.classList.add("about"),i.B.classList.add("screen-visible")):i.B.classList.remove("screen-visible","about")},V=e=>{n(".detail .info").forEach(o=>{let s=o.parentNode,{slug:r}=s.dataset;if(r===e){s.classList.add("visible");let c=s.offsetTop;a.num(c)&&(s.parentNode.parentNode.scrollTop=c)}else s.classList.remove("visible")})},J=({map:e,popup:t})=>{if(!e||!e.locationLayer)return;[e.locationLayer,e.artifactLayer].forEach(s=>{s.eachLayer(r=>{t&&r.slug===t&&r.openPopup()})})},te=e=>{e.currentTarget.parentNode.scrollTop=0},L,ut=e=>{L=e;let t=new URL(i.location);t.hash.includes("&t=1")||(t.hash=`${t.hash}&t=1`,i.history.pushState({},"",t))},ht=()=>{L=null,Z()},oe=async()=>{if(L)return await L.onExitButtonClick(),L=null,!0},se=(e,t,o)=>Math.min(o,Math.max(t,e)),N=(e,t,o)=>se(Math.round(e+o*(t-e)),0,255),q=(e,t,o)=>{let[s,r,c]=e,[p,d,l]=t,y=N(s,p,o),f=N(r,d,o),h=N(c,l,o);return`rgb(${y}, ${f}, ${h})`},re=(e,t)=>{let o=`* {scrollbar-color: ${t} ${e};}`,s=n("#js-css");s||(s=n.create("style",{id:"js-css"})),s.innerHTML=o,n("head",{single:!0}).appendChild(s)},O=e=>{let t=n(".screen.about",{single:!0}),o=n(".hero",{single:!0}),s=n("header.main",{single:!0}),r=o&&s?o.clientHeight+s.clientHeight+200:0,c=n("#cityslide"),p=n(".mainMenu",{single:!0}),d=n(".logoPath",{single:!0}),l=t&&t.classList.contains("visible"),y=e===!0||l,f=t&&t.scrollTop<r;if(y&&f){let h=t.scrollTop;if(c.style.marginLeft=`-${h}px`,s&&o){let u=h/o.clientHeight,m=q([12,12,12],[250,250,250],u);s.style.backgroundColor=m;let x=q([250,250,250],[12,12,12],u);p&&(p.style.color=x),d&&(d.style.fill=x),re(m,x)}}else if(s.style.backgroundColor){s.style={},p.style={},d.style={};let h=n("#js-css");h&&(h.innerHTML="")}},ne=()=>{let e=n(".screen.about",{single:!0});e&&(O(!0),n.on(e,"scroll",O,{passive:!0}))},ie=e=>async()=>{if(await oe())return!1;let o=e.getCenter(),s=e.getZoom(),{lat:r=o.lat,lng:c=o.lng,zoom:p=s,popup:d,screen:l,detail:y}=I();_(l),V(y),W(l),H({map:e,zoom:p}),J({map:e,popup:d}),P(),O(),(o.lat!==r||o.lng!==c||p!==s)&&e.setView({lat:r,lng:c},p)},ce=e=>{let t=e.popup?._source?.slug;t&&v({popup:t})},ae=()=>{v({popup:!1})},le=e=>{let{lat:t,lng:o}=e.target.getCenter();v({lat:t,lng:o})},fe=e=>{let t=e.target,{lat:o,lng:s}=t.getCenter(),r=t.getZoom();v({lat:o,lng:s,zoom:r})},mt=({map:e,lat:t,lng:o,zoom:s,detail:r})=>()=>{let c=e.getZoom(),p=c>s?c:s;v({lat:t,lng:o,detail:r,zoom:p})},pe=e=>t=>{let o=t.currentTarget,{dataset:s,classList:r,parentNode:c}=o,{to:p}=s,{z:d,lat:l,lng:y,detail:f,popup:h}=s,{slug:u}=c.dataset,m,x;p?r.contains("active")?r.contains("no-toggle")||(m=!1):m=p:(r.contains("exit")||r.contains("close")&&i.B.clientWidth<800)&&(m=!1),u&&[e.locationLayer,e.artifactLayer].forEach(E=>{E.eachLayer(F=>{F.slug===u&&(x=u)})}),f==="show"?c.classList.contains("visible")?f=!1:f=u:f==="hide"&&(f=!1),h&&(x=h),v({detail:f,lat:l,lng:y,zoom:d,popup:x,screen:m}),r.contains("scroll")&&setTimeout(()=>{let z=c.parentNode.parentNode,E=c.offsetTop;z.scrollTop=E},50)},gt=e=>{if(!ee()){let{lat:t,lng:o,zoom:s}=e,r=!1;return i.APP_DB.cities&&!i.APP_DB.city?r="about":i.innerWidth>600&&(r="list"),v({lat:t,lng:o,zoom:s,screen:r}),i.STATE={lat:t,lng:o,zoom:s},i.OLD_STATE=i.STATE,{lat:t,lng:o,zoom:s}}return I()},yt=e=>{let{popup:t,screen:o,zoom:s,detail:r}=I();H({map:e,zoom:s}),t&&J({map:e,popup:t}),W(o),o&&(_(o),i.B.classList.add("screen-visible")),V(r),P(),ne(!0),n.on(i,"popstate",ie(e)),n.on(e,"popupopen",ce),n.on(e,"popupclose",ae),n.on(e,"zoomend",fe),n.on(e,"dragend",le),n.on(".nav","click",pe(e)),n.on(".backToTop","click",te)};var vt=e=>e*(Math.PI/180);export{de as a,a as b,i as c,n as d,D as e,Se as f,Ae as g,X as h,Ce as i,we as j,je as k,Ie as l,Ne as m,U as n,Me as o,Oe as p,ze as q,$e as r,De as s,Be as t,Ue as u,ke as v,Re as w,Ze as x,He as y,We as z,_e as A,Ve as B,Je as C,qe as D,Fe as E,Ge as F,Ke as G,Ye as H,Qe as I,Xe as J,et as K,tt as L,ot as M,st as N,ut as O,ht as P,mt as Q,gt as R,yt as S,vt as T};
