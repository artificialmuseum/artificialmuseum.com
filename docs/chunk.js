var F=Object.defineProperty;var pt=(t,e)=>{for(var o in e)F(t,o,{get:e[o],enumerable:!0})};var a=(t,e)=>typeof a[e]=="function"?a[e](t):typeof t===e;a.fn=t=>typeof t=="function";a.str=t=>typeof t=="string";a.obj=t=>typeof t=="object";a.arr=t=>Array.isArray(t);a.bool=t=>typeof t=="boolean";a.num=t=>t===+t;var S=class{constructor({W:e,type:o="session"}){try{let s=e[`${o}Storage`],r=`random-${M.random()}`;s.setItem(r,r),s.removeItem(r),this.store=s}catch{this.store={}}}setItem(e,o){let s=["setItem","getItem","removeItem"],r=s.indexOf(e);if(r>-1)throw new Error(`can not overwrite store.${s[r]}, it's a builtin`);let c=JSON.stringify(o);return this.store[e]=c,!0}getItem(e,o=void 0){return this.store.hasOwnProperty(e)?JSON.parse(this.store[e]):o}removeItem(e){a.fn(this.store.removeItem)?this.store.removeItem(e):delete this.store[e]}clear(){a.fn(this.store.clear)?this.store.clear():this.store={}}};var i=window;i.D=document;i.B=i.D.body;i.M=Math;i.NAV=i.navigator;i.UA=i.NAV.userAgent.toLowerCase()||"";i.URL=i.URL||i.webkitURL;i.store=new S({W:i,type:"session"});var n=(t,e={})=>{let{parent:o=i.D,single:s=!1}=e,r=t.split(" "),c=r[r.length-1];return s||c.startsWith("#")?o.querySelector(t):Array.from(o.querySelectorAll(t))};n.show=(t,e)=>{if(!!t){if(a.str(t)&&(t=n(t,e)),a.arr(t)){t.forEach(o=>n.show(o,e));return}t.classList&&t.classList.add("visible")}};n.hide=(t,e)=>{if(!!t){if(a.str(t)&&(t=n(t,e)),a.arr(t)){t.forEach(o=>n.hide(o,e));return}t.classList&&t.classList.remove("visible")}};n.prop=(t,e={})=>{a.str(t)&&(t=n(t)),Object.entries(e).forEach(([o,s])=>{s===!1?t.removeAttribute(o):t.setAttribute(o,s)})};n.create=(t="div",e={})=>{let{className:o,id:s,innerText:r,children:c,on:p,parent:d,style:l,...x}=e,f=i.D.createElement(t);o&&(f.className=o),r&&(f.innerText=r),c&&(a.str(c)?f.innerText+=c:a.arr(c)&&c.forEach(u=>f.appendChild(u))),l&&Object.entries(l).forEach(([u,m])=>{f.style[u]=m}),s&&f.setAttribute("id",s),p&&Object.entries(p).forEach(([u,m])=>{f.addEventListener(u,m)}),d&&n.append(f,d);let h=Object.entries(x);return h.length&&h.map(([u,m])=>{f.setAttribute(u,m)}),f};n.on=(t,e,o,s={})=>{a.str(t)&&(t=n(t)),a.arr(t)?t.forEach(r=>r.addEventListener(e,o,!1,s)):t.addEventListener(e,o,!1,s)};n.off=(t,e,o,s)=>{a.str(t)&&(t=n(t)),a.arr(t)?t.forEach(r=>r.removeEventListener(e,o,!1,s)):t.removeEventListener(e,o,!1,s)};n.append=(t,e=B)=>{a.str(t)&&(t=n(t)),a.str(e)&&(e=n(e)),e&&t&&(a.arr(t)?t.forEach(o=>e.appendChild(o)):e.appendChild(t))};n.remove=t=>{!t||(a.str(t)&&(t=n(t)),t&&t.parentNode&&t.parentNode.removeChild(t))};var g=i.UA,G=g.includes("mac")&&"ontouchend"in i.D,K=["ipad","iphone","ipod"].some(t=>g.includes(t)),D=K||G,Et=!D&&g.includes("macintosh"),St=g.includes("applewebkit")&&g.includes("safari")&&!g.includes("crios"),Y=()=>{let t;if(g.includes("chrome/")?t=g.split("chrome/")[1]:g.includes("samsungbrowser/")&&(t=g.split("samsungbrowser/")[1]),t){t=t.split(".")[0];let e=parseInt(t,10);if(a.num(e))return e}},Q=Y(),At=a.num(Q),Ct=g.includes("android"),wt=D&&g.includes("webxrviewer");var It=1,Nt="map-container",j=17,A=7,Ot=['<a target="_top" rel="nofollow noopener noreferrer" href="https://openstreetmap.org" title="data from openstreetmap">osm</a>','<a target="_top" rel="nofollow noopener noreferrer" href="https://leafletjs.com" title="leaflet.js map library">leaflet</a>','<a target="_top" rel="nofollow noopener noreferrer" href="https://stamen.com" title="tile design by stamen.com">stamen</a>'].join("<br>"),zt=20,Mt=500;var L=[38,38],C=[L[0]/2,L[1]/2],w=[0,L[1]/2*-1],P="map/marker",$t={location:{iconUrl(t){let e=t>0?t:1;return t>9&&(e="9-plus"),`${P}/location-${e}.svg`},iconSize:L,iconAnchor:C,popupAnchor:w},city:{iconUrl:t=>`${P}/cities/${t}.svg`,iconSize:L,iconAnchor:C,popupAnchor:w},artifact:{iconUrl:`${P}/object.svg`,iconSize:L,iconAnchor:C,popupAnchor:w}},Dt={strings:{title:"Click to locate yourself.",metersUnit:"meters",feetUnit:"feet",popup:"You are within {distance} {unit} from this point",outsideMapBoundsMsg:`
It seems like your Device has no gps sensors, or you declined our request to use gps.
`},locateOptions:{watch:!0,enableHighAccuracy:!0}},jt={fov:60,near:.01,far:500},Bt={maxDistance:60,minDistance:1,maxPolarAngle:Math.PI/1.9,enablePan:!1},Ut={ambientColor:16777215,ambientIntensity:.5,directionalColor:16777215,directionalIntensity:2.5,directionalPosition:[15,30,7]},kt=.2,U=16,Rt=[100,60,40],Zt="skybox",Ht="3D Visualization:",Wt="Sound:",_t="three-running",Vt={x:0,y:1.5,z:5},Jt=(t,e="at this location.")=>(t===0?t="are no artifacts":t===1?t="is 1 artifact":t>1&&(t=`are ${t} artifacts`),`There ${t} ${e}`),qt=10*1e3,Ft="Zoom to location",Gt="Visit City",Kt="three-audio",Yt="three-video",Qt="three-canvas",Xt="three-container",te="hud",ee="hud-exit-button",oe=1e4;var T=(t,e=8)=>parseFloat(t).toPrecision(e)/1;var I=()=>{};var X=()=>i.location.hash.length>0,k=()=>new URLSearchParams(i.location.hash.substr(1)),N=()=>{let t=k(),e=t.get("z");a.num(parseInt(e,10))||t.set("z",j);let o={},s={z:"zoom",d:"detail",p:"popup",s:"screen"};for(let[r,c]of t.entries())r in s&&(r=s[r]),o[r]=c;return o},v=(t={})=>{i.STATE={...i.STATE,...t};let e=JSON.stringify(i.STATE),o=JSON.stringify(i.OLD_STATE);e!==o&&(R(i.STATE),i.OLD_STATE=i.STATE)},R=(t={})=>{let{detail:e,lat:o,lng:s,popup:r,screen:c,three:p,zoom:d}=t,l=k();d&&l.set("z",T(d,3)),o&&l.set("lat",T(o,A)),s&&l.set("lng",T(s,A)),r?l.set("p",r):r===!1&&l.delete("p"),e?l.set("d",e):e===!1&&l.delete("d"),c?l.set("s",c):c===!1&&l.delete("s"),p||l.delete("t"),i.location.hash=l.toString()},Z=({map:t,zoom:e})=>{let{locationLayer:o,artifactLayer:s}=t;!o||(e>=U?(t.hasLayer(o)&&t.removeLayer(o),t.hasLayer(s)||t.addLayer(s)):(t.hasLayer(o)||t.addLayer(o),t.hasLayer(s)&&t.removeLayer(s)))},H=t=>{let e=n(".nav.menu");t?e.forEach(o=>{if(!o.dataset.to){o.classList.remove("active");return}let s=o.dataset.to===t||o.classList.contains(t),r=t.includes("-")&&o.classList.contains(t.split("-")[0]);s||r?o.classList.add("active"):o.classList.remove("active")}):e.forEach(o=>{o.classList.contains("map")?o.classList.add("active"):o.classList.remove("active")})},W=t=>{let e=!1;if(t==="home"&&(t="about"),n(".screen.visible").forEach(r=>{r.classList.remove("visible")}),n(`.screen[data-name=${t}]`).forEach(r=>{r.classList.add("visible"),e=!0}),t){let r;t.startsWith("list-")?r=n(".screen[data-name=list]",{single:!0}):t.startsWith("help-")&&(r=n(".screen[data-name=help]",{single:!0})),r&&(r.classList.add("visible"),e=!0)}e?(t==="about"&&i.B.classList.add("about"),i.B.classList.add("screen-visible")):i.B.classList.remove("screen-visible","about")},_=t=>{n(".detail .info").forEach(o=>{let s=o.parentNode,{slug:r}=s.dataset;if(r===t){s.classList.add("visible");let c=s.offsetTop;a.num(c)&&(s.parentNode.parentNode.scrollTop=c)}else s.classList.remove("visible")})},V=({map:t,popup:e})=>{if(!t||!t.locationLayer)return;[t.locationLayer,t.artifactLayer].forEach(s=>{s.eachLayer(r=>{e&&r.slug===e&&r.openPopup()})})},tt=t=>{t.currentTarget.parentNode.scrollTop=0},b,de=t=>{b=t;let e=new URL(i.location);e.hash.includes("&t=1")||(e.hash=`${e.hash}&t=1`,i.history.pushState({},"",e))},ue=()=>{b=null,R()},et=async()=>{if(b)return await b.onExitButtonClick(),b=null,!0},ot=(t,e,o)=>Math.min(o,Math.max(e,t)),O=(t,e,o)=>ot(Math.round(t+o*(e-t)),0,255),J=(t,e,o)=>{let[s,r,c]=t,[p,d,l]=e,x=O(s,p,o),f=O(r,d,o),h=O(c,l,o);return`rgb(${x}, ${f}, ${h})`},st=(t,e)=>{let o=`* {scrollbar-color: ${e} ${t};}`,s=n("#js-css");s||(s=n.create("style",{id:"js-css"})),s.innerHTML=o,n("head",{single:!0}).appendChild(s)},z=t=>{let e=n(".screen.about",{single:!0}),o=n(".hero",{single:!0}),s=n("header.main",{single:!0}),r=o&&s?o.clientHeight+s.clientHeight+200:0,c=n("#cityslide"),p=n(".mainMenu",{single:!0}),d=n(".logoPath",{single:!0}),l=e&&e.classList.contains("visible"),x=t===!0||l,f=e&&e.scrollTop<r;if(x&&f){let h=e.scrollTop;if(c.style.marginLeft=`-${h}px`,s&&o){let u=h/o.clientHeight,m=J([12,12,12],[250,250,250],u);s.style.backgroundColor=m;let y=J([250,250,250],[12,12,12],u);p&&(p.style.color=y),d&&(d.style.fill=y),st(m,y)}}else if(s.style.backgroundColor){s.style={},p.style={},d.style={};let h=n("#js-css");h&&(h.innerHTML="")}},rt=()=>{let t=n(".screen.about",{single:!0});t&&(z(!0),n.on(t,"scroll",z,{passive:!0}))},nt=t=>async()=>{if(await et())return!1;let o=t.getCenter(),s=t.getZoom(),{lat:r=o.lat,lng:c=o.lng,zoom:p=s,popup:d,screen:l,detail:x}=N();W(l),_(x),H(l),Z({map:t,zoom:p}),V({map:t,popup:d}),I(),z(),(o.lat!==r||o.lng!==c||p!==s)&&t.setView({lat:r,lng:c},p)},it=t=>{let e=t.popup?._source?.slug;e&&v({popup:e})},ct=()=>{v({popup:!1})},at=t=>{let{lat:e,lng:o}=t.target.getCenter();v({lat:e,lng:o})},lt=t=>{let e=t.target,{lat:o,lng:s}=e.getCenter(),r=e.getZoom();v({lat:o,lng:s,zoom:r})},he=({map:t,lat:e,lng:o,zoom:s,detail:r})=>()=>{let c=t.getZoom(),p=c>s?c:s;v({lat:e,lng:o,detail:r,zoom:p})},ft=t=>e=>{let o=e.currentTarget,{dataset:s,classList:r,parentNode:c}=o,{to:p}=s,{z:d,lat:l,lng:x,detail:f,popup:h}=s,{slug:u}=c.dataset,m,y;p?r.contains("active")?r.contains("no-toggle")||(m=!1):m=p:(r.contains("exit")||r.contains("close")&&i.B.clientWidth<800)&&(m=!1),u&&[t.locationLayer,t.artifactLayer].forEach(E=>{E.eachLayer(q=>{q.slug===u&&(y=u)})}),f==="show"?c.classList.contains("visible")?f=!1:f=u:f==="hide"&&(f=!1),h&&(y=h),v({detail:f,lat:l,lng:x,zoom:d,popup:y,screen:m}),r.contains("scroll")&&setTimeout(()=>{let $=c.parentNode.parentNode,E=c.offsetTop;$.scrollTop=E},50)},me=t=>{if(!X()){let{lat:e,lng:o,zoom:s}=t,r=!1;return i.APP_DB.cities&&!i.APP_DB.city?r="about":i.innerWidth>600&&(r="list"),v({lat:e,lng:o,zoom:s,screen:r}),i.STATE={lat:e,lng:o,zoom:s},i.OLD_STATE=i.STATE,{lat:e,lng:o,zoom:s}}return N()},ge=t=>{let{popup:e,screen:o,zoom:s,detail:r}=N();Z({map:t,zoom:s}),e&&V({map:t,popup:e}),H(o),o&&(W(o),i.B.classList.add("screen-visible")),_(r),I(),rt(!0),n.on(i,"popstate",nt(t)),n.on(t,"popupopen",it),n.on(t,"popupclose",ct),n.on(t,"zoomend",lt),n.on(t,"dragend",at),n.on(".nav","click",ft(t)),n.on(".backToTop","click",tt)};var ye=t=>t*(Math.PI/180);export{pt as a,a as b,i as c,n as d,D as e,Et as f,St as g,Q as h,At as i,Ct as j,wt as k,It as l,Nt as m,j as n,Ot as o,zt as p,Mt as q,$t as r,Dt as s,jt as t,Bt as u,Ut as v,kt as w,Rt as x,Zt as y,Ht as z,Wt as A,_t as B,Vt as C,Jt as D,qt as E,Ft as F,Gt as G,Kt as H,Yt as I,Qt as J,Xt as K,te as L,ee as M,oe as N,de as O,ue as P,he as Q,me as R,ge as S,ye as T};
