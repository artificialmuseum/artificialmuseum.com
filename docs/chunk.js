var F=Object.defineProperty;var pe=(e,t)=>{for(var o in t)F(e,o,{get:t[o],enumerable:!0})};var c=(e,t)=>typeof c[t]=="function"?c[t](e):typeof e===t;c.fn=e=>typeof e=="function";c.str=e=>typeof e=="string";c.obj=e=>typeof e=="object";c.arr=e=>Array.isArray(e);c.bool=e=>typeof e=="boolean";c.num=e=>e===+e;var S=class{constructor({W:t,type:o="session"}){try{let s=t[`${o}Storage`],r=`random-${M.random()}`;s.setItem(r,r),s.removeItem(r),this.store=s}catch{this.store={}}}setItem(t,o){let s=["setItem","getItem","removeItem"],r=s.indexOf(t);if(r>-1)throw new Error(`can not overwrite store.${s[r]}, it's a builtin`);let a=JSON.stringify(o);return this.store[t]=a,!0}getItem(t,o=void 0){return this.store.hasOwnProperty(t)?JSON.parse(this.store[t]):o}removeItem(t){c.fn(this.store.removeItem)?this.store.removeItem(t):delete this.store[t]}clear(){c.fn(this.store.clear)?this.store.clear():this.store={}}};var i=window;i.D=document;i.B=i.D.body;i.M=Math;i.NAV=i.navigator;i.UA=i.NAV.userAgent.toLowerCase()||"";i.URL=i.URL||i.webkitURL;i.store=new S({W:i,type:"session"});var n=(e,t={})=>{let{parent:o=i.D,single:s=!1}=t,r=e.split(" "),a=r[r.length-1];return s||a.startsWith("#")?o.querySelector(e):Array.from(o.querySelectorAll(e))};n.show=(e,t)=>{if(!!e){if(c.str(e)&&(e=n(e,t)),c.arr(e)){e.forEach(o=>n.show(o,t));return}e.classList&&e.classList.add("visible")}};n.hide=(e,t)=>{if(!!e){if(c.str(e)&&(e=n(e,t)),c.arr(e)){e.forEach(o=>n.hide(o,t));return}e.classList&&e.classList.remove("visible")}};n.prop=(e,t={})=>{c.str(e)&&(e=n(e)),Object.entries(t).forEach(([o,s])=>{s===!1?e.removeAttribute(o):e.setAttribute(o,s)})};n.create=(e="div",t={})=>{let{className:o,id:s,innerText:r,children:a,on:p,parent:d,style:l,...x}=t,f=i.D.createElement(e);o&&(f.className=o),r&&(f.innerText=r),a&&(c.str(a)?f.innerText+=a:c.arr(a)&&a.forEach(u=>f.appendChild(u))),l&&Object.entries(l).forEach(([u,m])=>{f.style[u]=m}),s&&f.setAttribute("id",s),p&&Object.entries(p).forEach(([u,m])=>{f.addEventListener(u,m)}),d&&n.append(f,d);let h=Object.entries(x);return h.length&&h.map(([u,m])=>{f.setAttribute(u,m)}),f};n.on=(e,t,o,s={})=>{c.str(e)&&(e=n(e)),c.arr(e)?e.forEach(r=>r.addEventListener(t,o,!1,s)):e.addEventListener(t,o,!1,s)};n.off=(e,t,o,s)=>{c.str(e)&&(e=n(e)),c.arr(e)?e.forEach(r=>r.removeEventListener(t,o,!1,s)):e.removeEventListener(t,o,!1,s)};n.append=(e,t=B)=>{c.str(e)&&(e=n(e)),c.str(t)&&(t=n(t)),t&&e&&(c.arr(e)?e.forEach(o=>t.appendChild(o)):t.appendChild(e))};n.remove=e=>{!e||(c.arr(e)&&e.forEach(n.remove),c.str(e)&&(e=n(e)),e&&e.parentNode&&e.parentNode.removeChild(e))};var g=i.UA,G=g.includes("mac")&&"ontouchend"in i.D,K=["ipad","iphone","ipod"].some(e=>g.includes(e)),D=K||G,Ee=!D&&g.includes("macintosh"),Se=g.includes("applewebkit")&&g.includes("safari")&&!g.includes("crios"),Y=()=>{let e;if(g.includes("chrome/")?e=g.split("chrome/")[1]:g.includes("samsungbrowser/")&&(e=g.split("samsungbrowser/")[1]),e){e=e.split(".")[0];let t=parseInt(e,10);if(c.num(t))return t}},Q=Y(),Ae=c.num(Q),Ce=g.includes("android"),we=D&&g.includes("webxrviewer");var Ie=1,Ne="map-container",j=17,A=7,Oe=['<a target="_top" rel="nofollow noopener noreferrer" href="https://openstreetmap.org" title="data from openstreetmap">osm</a>','<a target="_top" rel="nofollow noopener noreferrer" href="https://leafletjs.com" title="leaflet.js map library">leaflet</a>','<a target="_top" rel="nofollow noopener noreferrer" href="https://stamen.com" title="tile design by stamen.com">stamen</a>'].join("<br>"),ze=50,Me=500;var L=[38,38],C=[L[0]/2,L[1]/2],w=[0,L[1]/2*-1],P="map/marker",$e={location:{iconUrl(e){let t=e>0?e:1;return e>9&&(t="9-plus"),`${P}/location-${t}.svg`},iconSize:L,iconAnchor:C,popupAnchor:w},city:{iconUrl:e=>`${P}/cities/${e}.svg`,iconSize:L,iconAnchor:C,popupAnchor:w},artifact:{iconUrl:`${P}/object.svg`,iconSize:L,iconAnchor:C,popupAnchor:w}},De={strings:{title:"Click to locate yourself.",metersUnit:"meters",feetUnit:"feet",popup:"You are within {distance} {unit} from this point",outsideMapBoundsMsg:`
It seems like your Device has no gps sensors, or you declined our request to use gps.
`},locateOptions:{watch:!0,enableHighAccuracy:!0}},je={fov:60,near:.01,far:500},Be={maxDistance:60,minDistance:1,maxPolarAngle:Math.PI/1.9,enablePan:!1},Ue={ambientColor:16777215,ambientIntensity:.5,directionalColor:16777215,directionalIntensity:2.5,directionalPosition:[15,30,7]},ke=.2,U=16,Re=[100,60,40],Ze="skybox",He="3D Visualization:",We="Sound:",_e="three-running",Ve={x:0,y:1.5,z:5},Je=(e,t="at this location.")=>(e===0?e="are no artifacts":e===1?e="is 1 artifact":e>1&&(e=`are ${e} artifacts`),`There ${e} ${t}`),qe=10*1e3,Fe="Zoom to location",Ge="Visit City",Ke="three-audio",Ye="three-video",Qe="three-canvas",Xe="three-container",et="hud",tt="hud-exit-button",ot=1e4;var T=(e,t=8)=>parseFloat(e).toPrecision(t)/1;var I=()=>{};var X=()=>i.location.hash.length>0,k=()=>new URLSearchParams(i.location.hash.substr(1)),N=()=>{let e=k(),t=e.get("z");c.num(parseInt(t,10))||e.set("z",j);let o={},s={z:"zoom",d:"detail",p:"popup",s:"screen"};for(let[r,a]of e.entries())r in s&&(r=s[r]),o[r]=a;return o},v=(e={})=>{i.STATE={...i.STATE,...e};let t=JSON.stringify(i.STATE),o=JSON.stringify(i.OLD_STATE);t!==o&&(R(i.STATE),i.OLD_STATE=i.STATE)},R=(e={})=>{let{detail:t,lat:o,lng:s,popup:r,screen:a,three:p,zoom:d}=e,l=k();d&&l.set("z",T(d,3)),o&&l.set("lat",T(o,A)),s&&l.set("lng",T(s,A)),r?l.set("p",r):r===!1&&l.delete("p"),t?l.set("d",t):t===!1&&l.delete("d"),a?l.set("s",a):a===!1&&l.delete("s"),p||l.delete("t"),i.location.hash=l.toString()},Z=({map:e,zoom:t})=>{let{locationLayer:o,artifactLayer:s}=e;!o||(t>=U?(e.hasLayer(o)&&e.removeLayer(o),e.hasLayer(s)||e.addLayer(s)):(e.hasLayer(o)||e.addLayer(o),e.hasLayer(s)&&e.removeLayer(s)))},H=e=>{let t=n(".nav.menu");e?t.forEach(o=>{if(!o.dataset.to){o.classList.remove("active");return}let s=o.dataset.to===e||o.classList.contains(e),r=e.includes("-")&&o.classList.contains(e.split("-")[0]);s||r?o.classList.add("active"):o.classList.remove("active")}):t.forEach(o=>{o.classList.contains("map")?o.classList.add("active"):o.classList.remove("active")})},W=e=>{let t=!1;if(e==="home"&&(e="about"),n(".screen.visible").forEach(r=>{r.classList.remove("visible")}),n(`.screen[data-name=${e}]`).forEach(r=>{r.classList.add("visible"),t=!0}),e){let r;e.startsWith("list-")?r=n(".screen[data-name=list]",{single:!0}):e.startsWith("help-")&&(r=n(".screen[data-name=help]",{single:!0})),r&&(r.classList.add("visible"),t=!0)}t?(e==="about"&&i.B.classList.add("about"),i.B.classList.add("screen-visible")):i.B.classList.remove("screen-visible","about")},_=e=>{n(".detail .info").forEach(o=>{let s=o.parentNode,{slug:r}=s.dataset;if(r===e){s.classList.add("visible");let a=s.offsetTop;c.num(a)&&(s.parentNode.parentNode.scrollTop=a)}else s.classList.remove("visible")})},V=({map:e,popup:t})=>{if(!e||!e.locationLayer)return;[e.locationLayer,e.artifactLayer].forEach(s=>{s.eachLayer(r=>{t&&r.slug===t&&r.openPopup()})})},ee=e=>{e.currentTarget.parentNode.scrollTop=0},b,dt=e=>{b=e;let t=new URL(i.location);t.hash.includes("&t=1")||(t.hash=`${t.hash}&t=1`,i.history.pushState({},"",t))},ut=()=>{b=null,R()},te=async()=>{if(b)return await b.onExitButtonClick(),b=null,!0},oe=(e,t,o)=>Math.min(o,Math.max(t,e)),O=(e,t,o)=>oe(Math.round(e+o*(t-e)),0,255),J=(e,t,o)=>{let[s,r,a]=e,[p,d,l]=t,x=O(s,p,o),f=O(r,d,o),h=O(a,l,o);return`rgb(${x}, ${f}, ${h})`},se=(e,t)=>{let o=`* {scrollbar-color: ${t} ${e};}`,s=n("#js-css");s||(s=n.create("style",{id:"js-css"})),s.innerHTML=o,n("head",{single:!0}).appendChild(s)},z=e=>{let t=n(".screen.about",{single:!0}),o=n(".hero",{single:!0}),s=n("header.main",{single:!0}),r=o&&s?o.clientHeight+s.clientHeight+200:0,a=n("#cityslide"),p=n(".mainMenu",{single:!0}),d=n(".logoPath",{single:!0}),l=t&&t.classList.contains("visible"),x=e===!0||l,f=t&&t.scrollTop<r;if(x&&f){let h=t.scrollTop;if(a.style.marginLeft=`-${h}px`,s&&o){let u=h/o.clientHeight,m=J([12,12,12],[250,250,250],u);s.style.backgroundColor=m;let y=J([250,250,250],[12,12,12],u);p&&(p.style.color=y),d&&(d.style.fill=y),se(m,y)}}else if(s.style.backgroundColor){s.style={},p.style={},d.style={};let h=n("#js-css");h&&(h.innerHTML="")}},re=()=>{let e=n(".screen.about",{single:!0});e&&(z(!0),n.on(e,"scroll",z,{passive:!0}))},ne=e=>async()=>{if(await te())return!1;let o=e.getCenter(),s=e.getZoom(),{lat:r=o.lat,lng:a=o.lng,zoom:p=s,popup:d,screen:l,detail:x}=N();W(l),_(x),H(l),Z({map:e,zoom:p}),V({map:e,popup:d}),I(),z(),(o.lat!==r||o.lng!==a||p!==s)&&e.setView({lat:r,lng:a},p)},ie=e=>{let t=e.popup?._source?.slug;t&&v({popup:t})},ce=()=>{v({popup:!1})},ae=e=>{let{lat:t,lng:o}=e.target.getCenter();v({lat:t,lng:o})},le=e=>{let t=e.target,{lat:o,lng:s}=t.getCenter(),r=t.getZoom();v({lat:o,lng:s,zoom:r})},ht=({map:e,lat:t,lng:o,zoom:s,detail:r})=>()=>{let a=e.getZoom(),p=a>s?a:s;v({lat:t,lng:o,detail:r,zoom:p})},fe=e=>t=>{let o=t.currentTarget,{dataset:s,classList:r,parentNode:a}=o,{to:p}=s,{z:d,lat:l,lng:x,detail:f,popup:h}=s,{slug:u}=a.dataset,m,y;p?r.contains("active")?r.contains("no-toggle")||(m=!1):m=p:(r.contains("exit")||r.contains("close")&&i.B.clientWidth<800)&&(m=!1),u&&[e.locationLayer,e.artifactLayer].forEach(E=>{E.eachLayer(q=>{q.slug===u&&(y=u)})}),f==="show"?a.classList.contains("visible")?f=!1:f=u:f==="hide"&&(f=!1),h&&(y=h),v({detail:f,lat:l,lng:x,zoom:d,popup:y,screen:m}),r.contains("scroll")&&setTimeout(()=>{let $=a.parentNode.parentNode,E=a.offsetTop;$.scrollTop=E},50)},mt=e=>{if(!X()){let{lat:t,lng:o,zoom:s}=e,r=!1;return i.APP_DB.cities&&!i.APP_DB.city?r="about":i.innerWidth>600&&(r="list"),v({lat:t,lng:o,zoom:s,screen:r}),i.STATE={lat:t,lng:o,zoom:s},i.OLD_STATE=i.STATE,{lat:t,lng:o,zoom:s}}return N()},gt=e=>{let{popup:t,screen:o,zoom:s,detail:r}=N();Z({map:e,zoom:s}),t&&V({map:e,popup:t}),H(o),o&&(W(o),i.B.classList.add("screen-visible")),_(r),I(),re(!0),n.on(i,"popstate",ne(e)),n.on(e,"popupopen",ie),n.on(e,"popupclose",ce),n.on(e,"zoomend",le),n.on(e,"dragend",ae),n.on(".nav","click",fe(e)),n.on(".backToTop","click",ee)};var yt=e=>e*(Math.PI/180);export{pe as a,c as b,i as c,n as d,D as e,Ee as f,Se as g,Q as h,Ae as i,Ce as j,we as k,Ie as l,Ne as m,j as n,Oe as o,ze as p,Me as q,$e as r,De as s,je as t,Be as u,Ue as v,ke as w,Re as x,Ze as y,He as z,We as A,_e as B,Ve as C,Je as D,qe as E,Fe as F,Ge as G,Ke as H,Ye as I,Qe as J,Xe as K,et as L,tt as M,ot as N,dt as O,ut as P,ht as Q,mt as R,gt as S,yt as T};
