import{_ as e,aG as a,c as o,W as i,a8 as l,C as r,S as t,aF as n,a as s}from"../vendor.js";class f{constructor(o){var{artifact:i}=o,{ply:l={}}=i;this.config=e({file:i.slug,materials:["yellow"],positionOffset:.05,pointSize:1,scaleOffset:.01,defaultAlpha:i.alpha||"1.0",fallbackAlphaDivisor:3,computeVertexNormals:!1},l),this.model=new a}preload(e){var a=this;return o((function*(){var{preload:o}=e,{file:l}=a.config;l.startsWith("/")||(l="".concat(i.STATIC_URL,"/ply/").concat(l,".ply")),l.endsWith(".ply")||(l+=".ply");var r=o.plyLoader;a.geo=yield o.promisifiedLoad({loader:r,file:l}),a.config.computeVertexNormals&&a.geo.computeVertexNormals()}))()}beforeLoadModel(a){var f=this;return o((function*(){var{engine:o}=a,{materials:p,pointSize:u,positionOffset:c,scaleOffset:m,defaultAlpha:d,fallbackAlphaDivisor:v}=f.config,h={fragmentShader:"precision highp float;\n#define GLSLIFY 1\nuniform vec3 uColor;uniform float uAlpha;void main(){vec4 col=vec4(uColor,uAlpha);gl_FragColor=col;}",vertexShader:"precision highp float;\n#define GLSLIFY 1\nuniform float uSize;void main(){gl_PointSize=uSize;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.0);}",depthTest:!1,blending:l,uniforms:{uSize:{value:u*i.pxRatio,type:"f"},uColor:{value:new r(16711680),type:"f3"},uAlpha:{value:1,type:"f"}}},g=o.XR?1:v,S=new t(e(e({},h),{},{uniforms:e({},h.uniforms)})),y=new n(f.geo,S);p.forEach(((e,a)=>{var o=d;if(s.arr(e)){var[i,l=d]=e;o=l,e=i}o=(parseFloat(o)/g).toFixed(2).toString();var t=y.clone();t.material=t.material.clone(),t.material.uniforms.uColor.value=new r(e),t.material.uniforms.uAlpha.value=o;var n=1+a*m;t.scale.set(n,n,n),t.position.x=a*c,f.model.add(t)}))}))()}}export{f as default};
