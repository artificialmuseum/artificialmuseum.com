import{aM as e,a5 as t,a as i,S as a,_ as o,c as s,aF as r,aX as n,aY as l,aZ as u,at as d,a_ as c,aq as h,a$ as v,aU as p,R as m,b0 as f,aO as x,b1 as g,an as y,W as b}from"../vendor.js";var w=function(t){for(var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Infinity,s=t.getIndex()||t.getAttribute("position"),r=s.count/3,n=[],l=a;l<r&&l<=o;l++){var u=l%2==0,d=i?1:0;u?n.push(0,0,1,0,1,0,1,0,d):n.push(0,1,0,0,0,1,1,0,d)}var c=new Float32Array(n),h=new e(c,3);t.setAttribute("barycentric",h)};class S extends t{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{fill:t,stroke:s}=e.uniforms;(i.str(t.value)||i.num(t.value))&&(e.uniforms.fill.value=new a(t.value)),(i.str(s.value)||i.num(s.value))&&(e.uniforms.stroke.value=new a(s.value)),e.vertexShader||(e.vertexShader="#define GLSLIFY 1\nattribute vec3 barycentric;attribute float even;varying vec3 vBarycentric;varying vec3 vPosition;varying float vEven;varying vec2 vUv;void main(){gl_Position=projectionMatrix*modelViewMatrix*vec4(position.xyz,1.0);vBarycentric=barycentric;vPosition=position.xyz;vEven=even;vUv=uv;}"),e.fragmentShader||(e.fragmentShader="#define GLSLIFY 1\nvarying vec3 vBarycentric;varying float vEven;varying vec2 vUv;varying vec3 vPosition;uniform float time;uniform float thickness;uniform float secondThickness;uniform float dashRepeats;uniform float dashLength;uniform bool dashOverlap;uniform bool dashEnabled;uniform bool dashAnimate;uniform bool seeThrough;uniform bool insideAltColor;uniform bool dualStroke;uniform bool noiseA;uniform bool noiseB;uniform bool squeeze;uniform float squeezeMin;uniform float squeezeMax;uniform vec3 stroke;uniform vec3 fill;vec4 mod289(vec4 x){return x-floor(x*(1.0/289.0))*289.0;}float mod289(float x){return x-floor(x*(1.0/289.0))*289.0;}vec4 permute(vec4 x){return mod289(((x*34.0)+1.0)*x);}float permute(float x){return mod289(((x*34.0)+1.0)*x);}vec4 taylorInvSqrt(vec4 r){return 1.792-0.853*r;}float taylorInvSqrt(float r){return 1.792-0.853*r;}vec4 grad4(float j,vec4 ip){const vec4 ones=vec4(1.0,1.0,1.0,-1.0);vec4 p,s;p.xyz=floor(fract(vec3(j)*ip.xyz)*7.0)*ip.z-1.0;p.w=1.5-dot(abs(p.xyz),ones.xyz);s=vec4(lessThan(p,vec4(0.0)));p.xyz=p.xyz+(s.xyz*2.0-1.0)*s.www;return p;}\n#define F4 0.309\nfloat noise(vec4 v){const vec4 C=vec4(0.138,0.276,0.414,-0.447);vec4 i=floor(v+dot(v,vec4(F4)));vec4 x0=v-i+dot(i,C.xxxx);vec4 i0;vec3 isX=step(x0.yzw,x0.xxx);vec3 isYZ=step(x0.zww,x0.yyz);i0.x=isX.x+isX.y+isX.z;i0.yzw=1.0-isX;i0.y+=isYZ.x+isYZ.y;i0.zw+=1.0-isYZ.xy;i0.z+=isYZ.z;i0.w+=1.0-isYZ.z;vec4 i3=clamp(i0,0.0,1.0);vec4 i2=clamp(i0-1.0,0.0,1.0);vec4 i1=clamp(i0-2.0,0.0,1.0);vec4 x1=x0-i1+C.xxxx;vec4 x2=x0-i2+C.yyyy;vec4 x3=x0-i3+C.zzzz;vec4 x4=x0+C.wwww;i=mod289(i);float j0=permute(permute(permute(permute(i.w)+i.z)+i.y)+i.x);vec4 j1=permute(permute(permute(permute(i.w+vec4(i1.w,i2.w,i3.w,1.0))+i.z+vec4(i1.z,i2.z,i3.z,1.0))+i.y+vec4(i1.y,i2.y,i3.y,1.0))+i.x+vec4(i1.x,i2.x,i3.x,1.0));vec4 ip=vec4(1.0/294.0,1.0/49.0,1.0/7.0,0.0);vec4 p0=grad4(j0,ip);vec4 p1=grad4(j1.x,ip);vec4 p2=grad4(j1.y,ip);vec4 p3=grad4(j1.z,ip);vec4 p4=grad4(j1.w,ip);vec4 norm=taylorInvSqrt(vec4(dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));p0*=norm.x;p1*=norm.y;p2*=norm.z;p3*=norm.w;p4*=taylorInvSqrt(dot(p4,p4));vec3 m0=max(0.6-vec3(dot(x0,x0),dot(x1,x1),dot(x2,x2)),0.0);vec2 m1=max(0.6-vec2(dot(x3,x3),dot(x4,x4)),0.0);m0=m0*m0;m1=m1*m1;return 49.0*(dot(m0*m0,vec3(dot(p0,x0),dot(p1,x1),dot(p2,x2)))+dot(m1*m1,vec2(dot(p3,x3),dot(p4,x4))));}float PI=3.14159265359;float aastep(float threshold,float dist){float afwidth=fwidth(dist)*0.5;return smoothstep(threshold-afwidth,threshold+afwidth,dist);}float computeScreenSpaceWireframe(vec3 barycentric,float lineWidth){vec3 dist=fwidth(barycentric);vec3 smoothed=smoothstep(dist*((lineWidth*0.5)-0.5),dist*((lineWidth*0.5)+0.5),barycentric);return 1.0-min(min(smoothed.x,smoothed.y),smoothed.z);}vec4 getStyledWireframe(vec3 barycentric){float d=min(min(barycentric.x,barycentric.y),barycentric.z);float noiseOff=0.0;if(noiseA){noiseOff+=noise(vec4(vPosition.xyz*1.0,time*0.35))*0.15;}if(noiseB){noiseOff+=noise(vec4(vPosition.xyz*80.0,time*0.5))*0.12;}d+=noiseOff;float positionAlong=max(barycentric.x,barycentric.y);if(barycentric.y<barycentric.x&&barycentric.y<barycentric.z){positionAlong=1.0-positionAlong;}float computedThickness=thickness;if(squeeze){computedThickness*=mix(squeezeMin,squeezeMax,(1.0-sin(positionAlong*PI)));}if(dashEnabled){float offset=1.0/dashRepeats*dashLength/2.0;if(!dashOverlap){offset+=1.0/dashRepeats/2.0;}if(dashAnimate){offset+=time*0.22;}float pattern=fract((positionAlong+offset)*dashRepeats);computedThickness*=1.0-aastep(dashLength,pattern);}float edge=1.0-aastep(computedThickness,d);vec4 outColor=vec4(0.0);if(seeThrough){outColor=vec4(stroke,edge);if(insideAltColor&&!gl_FrontFacing){outColor.rgb=fill;}}else{vec3 mainStroke=mix(fill,stroke,edge);outColor.a=1.0;if(dualStroke){float inner=1.0-aastep(secondThickness,d);vec3 wireColor=mix(fill,stroke,abs(inner-edge));outColor.rgb=wireColor;}else{outColor.rgb=mainStroke;}}return outColor;}void main(){gl_FragColor=getStyledWireframe(vBarycentric);}");var{extensions:r={}}=e;e.extensions=o(o({},r),{},{derivatives:!0}),super(e)}}class z{constructor(e){var{artifact:t}=e;this.artifact=t;var{radiusSegments:i=5,tube1Radius:a=.4,tube2Radius:o=.37,growSteps:s=1,edgeRemoval:r=!1,positionScaleFactor:n=1,tubeScale:l=.1,tube1Rotation:u=90,tube2Rotation:d=2*-Math.PI,audioTreshold:c=.02,fps:h=60,maximalSplineLength:v=5e3}=t;this.radiusSegments=i,this.tube1Radius=a*n,this.tube2Radius=o*n,this.growSteps=s,this.positionScaleFactor=n,this.audioTreshold=c,this.tubeScale=l,this.tube1Rotation=u,this.tube2Rotation=d,this.edgeRemoval=r,this.currentDrawRangeMin=0,this.direction=1,this.msBetweenSplineExpansions=1e3/h,this.maximalSplineLength=v,this.audioDistanceMaxMeters=8}preload(){var e=this;return s((function*(){e.data=yield e.loadData(),e.buffer=yield e.loadAudio(),e.matcapTexture=yield e.loadMatCap()}))()}loadMatCap(){var e="".concat(b.STATIC_URL,"/textures/matcap/grey-white-light.jpg");return new Promise((t=>{(new r).load(e,(e=>t(e)))}))}loadData(){var e=this;return s((function*(){var{artifact:t}=e,i=t.data?t.data:t.slug,a="".concat(b.STATIC_URL,"/data/").concat(i,".js"),{data:o}=yield import(a);return o}))()}init(e){var t=this;return s((function*(){var{engine:i,preload:a}=e,{camera:o,modelSpawned:s,renderer:r,scene:u,listener:d,XR:c}=i;t.listener=d,t.XR=c,t.scene=u,t.modelSpawned=s,t.engine=i,t.model=a.assets.gltf.scene,t.camera=o,o.far=1e3,o.updateProjectionMatrix(),t.renderer=r,r.toneMapping=n,r.outputEncoding=l,t.createCubes(),t.create3dSplines(),t.addAudio()}))()}spawnModel(){this.audioTarget1.play(),this.audioTarget2.play()}loadAudio(){var e=this;return s((function*(){var{artifact:t}=e,a=new u,o=i.str(t.audio)?t.audio:t.slug,s="".concat(b.MEDIA_URL,"/audio/").concat(o,".mp3");return new Promise((e=>{a.load(s,(t=>{e(t)}))}))}))()}addAudio(){var e=this;return s((function*(){var{camera:t,model:i,parent1:a,parent2:o}=e,s=new d;t.add(s);var r=a.position,n=new c(s);n.name="audiotarget_1",n.position.set(r.x,r.y,r.z),n.setBuffer(e.buffer),n.setLoop(!0),n.setVolume(0);var l=o.position,u=new c(s);u.name="audiotarget_2",u.position.set(l.x,l.y,l.z),u.setBuffer(e.buffer),u.setLoop(!0),u.setVolume(0),u.offset=.1,i.add(n),i.add(u),e.audioTarget1=n,e.audioTarget2=u}))()}createCubes(){var e=this.positionScaleFactor,t=1.1*e,i=new h(t,t,t),a=new v({matcap:this.matcapTexture});this.cubeGroup=new p,this.cubeGroup.position.set(0,0,0);for(var o=0;o<5;o++)for(var s=0;s<28;s++){var r=new m(i,a);r.name="Cube_".concat(o,"_").concat(s),r.rotateY(2*Math.PI/28*s),r.position.x=e*Math.sin(2*Math.PI/28*s)*Math.sqrt(28),r.position.z=e*Math.cos(2*Math.PI/28*s)*Math.sqrt(28),r.position.y=e*o*1.2+.5*t+.01,this.cubeGroup.add(r)}this.model.add(this.cubeGroup),this.collisionMaxDistance=t/2}create3dSplines(){var{artifact:e,radiusSegments:t,tube1Radius:i,tube2Radius:o,tube1Rotation:s,tube2Rotation:r,tubeScale:n,positionScaleFactor:l}=this,u=l*n;this.points=[{x:0,y:0,z:0},...this.data.map((e=>{var[t,i,a]=e;return{x:t*u,y:i*u,z:a*u}}))];var d=2*this.points.length;this.spline=new f(this.points,!1,"catmullrom"),this.parent1=new x,this.parent1.position.set(0,7*l,0),this.parent2=new x,this.parent2.position.set(0,5*l,0),this.tube1Geometry=new g(this.spline,d,i,t,!1).toNonIndexed(),this.tube1Geometry.rotateY(s),this.tube1Geometry.setDrawRange(0,this.maximalSplineLength),this.tube2Geometry=new g(this.spline,d,o,t,!1).toNonIndexed(),this.tube2Geometry.rotateY(r),this.tube2Geometry.setDrawRange(0,this.maximalSplineLength);var{spline1RemoveEdges:c=!0,spline2RemoveEdges:h=!0}=e;w(this.tube1Geometry,c),w(this.tube2Geometry,h);var{spline1Uniforms:v={time:{value:0},fill:{value:new a(14138052)},stroke:{value:new a(16711680)},noiseA:{value:!1},noiseB:{value:!0},dualStroke:{value:!1},seeThrough:{value:!0},insideAltColor:{value:!1},thickness:{value:.1},secondThickness:{value:.05},dashEnabled:{value:!1},dashRepeats:{value:1},dashOverlap:{value:!1},dashLength:{value:.7},dashAnimate:{value:!1},squeeze:{value:!0},squeezeMin:{value:.28},squeezeMax:{value:1}}}=e;this.spline1material=new S({uniforms:v,side:y,transparent:!0});var{spline2Uniforms:p={time:{value:0},fill:{value:new a(12802834)},stroke:{value:new a(16711680)},noiseA:{value:!1},noiseB:{value:!0},dualStroke:{value:!1},seeThrough:{value:!0},insideAltColor:{value:!1},thickness:{value:.1},secondThickness:{value:.05},dashEnabled:{value:!1},dashRepeats:{value:1},dashOverlap:{value:!1},dashLength:{value:.7},dashAnimate:{value:!1},squeeze:{value:!0},squeezeMin:{value:.28},squeezeMax:{value:1}}}=e;this.spline2material=new S({uniforms:p,side:y,transparent:!0});var b=new m(this.tube1Geometry,this.spline1material);b.name="tube_1";var z=new m(this.tube2Geometry,this.spline2material);z.name="tube_2",this.parent1.add(b),this.parent2.add(z),this.model.add(this.parent1),this.model.add(this.parent2)}removeCubeIfTouchedBySpline(e){this.cubeGroup.traverse((t=>{t.isMesh&&t.visible&&e.forEach((e=>{t.position.distanceToSquared(e)<this.collisionMaxDistance&&(t.visible=!1)}))}))}exit(){var e,t;this.tube1Geometry.setDrawRange(0,this.maximalSplineLength),this.tube2Geometry.setDrawRange(0,this.maximalSplineLength),null!==(e=this.audioTarget1)&&void 0!==e&&e.isPlaying&&this.audioTarget1.stop(),null!==(t=this.audioTarget2)&&void 0!==t&&t.isPlaying&&this.audioTarget2.stop(),this.cubeGroup.traverse((e=>{e.visible=!0}))}render(e,t){this.engine.modelSpawned&&(this.lastTimeStamp||(this.lastTimeStamp=this.msBetweenSplineExpansions+1),e-this.lastTimeStamp>=this.msBetweenSplineExpansions&&(this.lastTimeStamp=e,this.expandSpline()));this.renderer.render(this.scene,this.camera)}expandSpline(){var e=this.growSteps*this.radiusSegments*3*this.direction;this.currentDrawRangeMin+=e,this.tube1Geometry.setDrawRange(this.currentDrawRangeMin,this.maximalSplineLength),this.tube2Geometry.setDrawRange(this.currentDrawRangeMin,this.maximalSplineLength);for(var t=[],i=this.tube1Geometry.getAttribute("position").array,a=this.tube2Geometry.getAttribute("position").array,o=3*this.currentDrawRangeMin,s=3*(this.maximalSplineLength+this.currentDrawRangeMin),r=o;r<s;r+=3){var n={x:i[r],y:i[r+1]+this.parent1.position.y,z:i[r+2]};n.y>=0&&t.push(n);var l={x:a[r],y:a[r+1]+this.parent2.position.y,z:a[r+2]};l.y>=0&&t.push(l)}var u=t[t.length-2],d=t[t.length-1];this.repositionAudioTarget(this.audioTarget1,u),this.repositionAudioTarget(this.audioTarget2,d),this.removeCubeIfTouchedBySpline(t)}repositionAudioTarget(e,t){if(t&&e){var i=this.camera.position.distanceToSquared(t),a=e.getVolume(),o=Math.max(.1,Math.min(1,this.audioDistanceMaxMeters/i));Math.abs(a-o)>this.audioTreshold&&e.setVolume(o.toFixed(2))}}}export{z as default};
