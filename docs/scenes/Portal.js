import{aa as i,ah as t,ai as s}from"../vendor.js";class e{constructor(t){var{artifact:s,mergeConfig:e}=t;this.config=e(s.portal,{in:"inside",out:"clipCube",door:"door",target:"target",doorPosition:{x:0,y:0,z:0},doorWidth:1.4,doorHeight:2,cubeSize:4.05,doorZOffset:.05}),this.doorXOffset=this.config.doorWidth/2,this.cubeOffset=this.config.cubeSize/2,this.doorZOffset=.1,this.rotation=1,this.walkedThroughDoor=!1,this.rotationNormal=new i(0,1,0)}afterLoadModel(s){var{engine:e}=s;this.engine=e,this.camera=e.camera;var{model:r}=e;this.inside=r.getObjectByName(this.config.in),this.clipCube=r.getObjectByName(this.config.out),this.door=r.getObjectByName(this.config.door),this.rayTarget=r.getObjectByName(this.config.target),this.raycaster=new t,this.rayDirection=new i(0,0,-1)}isInDoor(i){var t=this.camera.position;this.rayDirection.z=i,this.raycaster.set(t,this.rayDirection);var s=this.raycaster.intersectObject(this.rayTarget);if(s.length){var{distance:e}=s[0];return e<.5}return!1}tick(){var{z:i}=this.camera.position,t=this.isInDoor(this.flipped?-1:1),e=this.isInDoor(this.flipped?1:-1),r=i*(this.flipped?-1:1);this.isInside?this.isInside&&r>=0&&e&&(this.triggerOutside=!0):r<=0&&t&&(this.triggerInside=!0),this.triggerInside&&!this.isInside&&(this.isInside=!0,this.triggerInside=!1,this.clipCube.visible&&(this.clipCube.visible=!1)),this.triggerOutside&&this.isInside&&(this.isInside=!1,this.triggerOutside=!1,this.clipCube.visible||(this.clipCube.visible=!0)),i<=0&&!this.flipped&&!this.isInside?(this.flipped=!0,this.engine.model.quaternion.setFromAxisAngle(this.rotationNormal,s.degToRad(180))):i>=0&&this.flipped&&!this.isInside&&(this.flipped=!1,this.engine.model.quaternion.setFromAxisAngle(this.rotationNormal,s.degToRad(0)))}}export{e as default};
