import{a9 as e,c as t,$ as i,_ as o,a$ as a,aX as n,O as r}from"../vendor.js";class s{constructor(t){var{artifact:i,mergeConfig:o,preload:a}=t;this.artifact=i,this.preloader=a,this.config=o(i,{apiHost:"api.artificialmuseum.com",font:{size:.2,height:.02,curveSegments:4,bevelThickness:.01,bevelSize:.01,bevelEnabled:!0}}),this.hasVoted=!1,this.parentPos=new e}preload(){var e=this;return t((function*(){var[t,i]=yield Promise.all([e.preloader.loadVideo({dir:"artificialroom",video:"gameover",id:"artificialroom-gVideo"}),e.preloader.loadVideo({dir:"artificialroom",video:"replay",id:"artificialroom-rVideo"})]);e.gVideo=t,e.rVideo=i}))()}exit(){i.remove([this.gVideo,this.rVideo,this.gButton,this.rButton])}afterLoadModel(e){var{engine:t,preload:n}=e;this.engine=t,this.parent=t.model,this.gChar=t.model.getObjectByName("cyborg_gameover"),this.rChar=t.model.getObjectByName("cyborg_replay"),t.model.getObjectByName("interface_01").castShadow=!1,t.model.getObjectByName("result").visible=!1;var r=o(o({},this.artifact),{},{scale:"3.0"});this.r3DG=new a({artifact:r,engine:t,preload:n,videoElement:this.gVideo}),t.model.getObjectByName("cyborg_gameover").getObjectByName("parent").add(this.r3DG.model);var s=o(o({},this.artifact),{},{scale:"1.5"});if(this.r3DR=new a({artifact:s,engine:t,preload:n,videoElement:this.rVideo}),t.model.getObjectByName("cyborg_replay").getObjectByName("parent_1").add(this.r3DR.model),this.gVideo.play(),this.rVideo.play(),!this.engine.XR){var c={fontSize:"1.1em",fontWeight:"bold",backgroundColor:"#fafafa",color:"#0c0c0c",padding:"0.5em",position:"fixed",bottom:"10px",width:"auto"};this.gButton=i.create("button",{id:"gameover",style:o(o({},c),{},{right:"51%",left:"auto"}),innerText:"GAMEOVER",on:{click:()=>this.sendVote(0)},parent:this.engine.hud.gui}),this.rButton=i.create("button",{id:"replay",style:o(o({},c),{},{left:"51%"}),innerText:"REPLAY",on:{click:()=>this.sendVote(1)},parent:this.engine.hud.gui})}this.gameOverAssets=["clipping_door","clipping","sphere","moon","end_replay"].map((e=>this.engine.model.getObjectByName(e))),this.gameOverAssets.forEach(((e,t)=>{e&&(e.userData.originalPosition={x:e.position.x,y:e.position.y,z:e.position.z},e.position.set(5e3,5e3,5e3))}))}onTouch(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.engine.XR&&e.length&&e.forEach((e=>{"cyborg_gameover_clicktarget"===e.target?this.sendVote(0):"cyborg_replay_clicktarget"===e.target&&this.sendVote(1)}))}sendVote(e){var i=this;return t((function*(){i.isVoting||(i.isVoting=!0,(yield window.fetch("https://".concat(i.config.apiHost,"/v1/vote?").concat(e))).ok&&(i.gButton&&(i.gButton.style.display="none"),i.rButton&&(i.rButton.style.display="none"),i.afterVote(e)))}))()}afterVote(e){var a=this;return t((function*(){var t;if(a.hasVoted=!0,a.isVoting=!1,a.vote=e,0===e?(t="replay",a.r3DR.model.visible=!1):1===e&&(t="gameover",a.r3DG.model.visible=!1),t){a.engine.actions.forEach((e=>{e._clip.name==="active_".concat(t)&&(e.paused=!0)}));var s=a.engine.model.getObjectByName("voting_replay");s&&(s.visible=!1);var c=a.engine.model.getObjectByName("voting_gameover");c&&(c.visible=!1)}var l=a.artifact.fonts[0],{assets:d}=a.preloader,g=d.fonts[l],{TextGeometry:m}=d.examples,p=yield fetch("https://".concat(a.config.apiHost,"/v1/result/?verbose=1")),h=yield p.json(),v=[new n({color:0,flatShading:!0}),new n({color:0})],f=new m("".concat(h.gp,"%"),o(o({},a.config.font),{},{font:g}));f.computeBoundingBox();var u=new r(f,v);u.geometry.center(),u.position.set(-1,1.8,0);var y=new m("".concat(h.rp,"%"),o(o({},a.config.font),{},{font:g}));y.computeBoundingBox();var b=new r(y,v);b.geometry.center(),b.position.set(1,1.8,0),a.engine.model.add(u),a.engine.model.add(b);var V=i.create("img",{src:"https://static.artificialmuseum.com/button/artificialroom/thanksforvoting.jpg",style:{top:"calc(50vh - 70px)",left:"calc(50vw - 150px)",width:"300px",height:"140px",margin:"0 auto",position:"fixed"},parent:a.engine.hud.gui});setTimeout((()=>{i.remove(V),a.gameOverAssets.forEach((e=>{var{x:t,y:i,z:o}=e.userData.originalPosition;e.position.set(t,i,o)})),a.engine.actions.find((e=>"clippDoor_opens"===e._clip.name)).paused=!1;var e=a.engine.actions.find((e=>"landing"===e._clip.name));setInterval((()=>{e.paused=!1}),3e3)}),2e3)}))()}}export{s as default};
