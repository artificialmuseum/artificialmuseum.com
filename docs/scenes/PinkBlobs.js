import{a_ as i,aj as a,ai as e}from"../vendor.js";class s{constructor(i){var{artifact:a,mergeConfig:e}=i;this.artifact=a,this.config=e(a,{numberOfClones:4}),this.originalBlobs=[],this.activeBlobs=[],this.mixers=[]}beforeLoadModel(i){var a=this,{engine:s,preload:t}=i,{scene:n,animations:o}=t.assets.gltf;this.engine=s;n.traverse((i=>{if("icePoop_gr"===i.name)for(var s=function(s){var t=i.clone();t.randomDelayNum=20*Math.random(),t.userData.waitUntil=t.randomDelayNum;var n=new e(t);a.resetAnimClip(o,n,t),n.addEventListener("finished",(()=>{n.animOver=!0,n.animScaleCount=0,n.animPosYCount=1})),a.activeBlobs.push(t),a.engine.scene.add(t),a.mixers.push(n)},t=0;t<this.config.numberOfClones;t++)s()}))}resetAnimClip(e,s,t){var n=i.findByName(e,"Anim_0");s.clipAction(n).stop(),s.clipAction(n).play().startAt(t.userData.waitUntil),s.clipAction(n).clampWhenFinished=!0,s.clipAction(n).setLoop(a,1),s.animOver=!1,s.animScaleCount=0,s.animPosYCount=1,t.scale.set(0,0,0),this.resetBlobStartPositions(t),s.clipAction(n).play()}resetBlobStartPositions(i){var a=Math.random()>.5?1:-1,e=5*Math.random()*a,s=2*Math.random(),t=Math.random()>.5?1:-1,n=5*Math.random()*t;i.position.set(5*e,s,5*n),i.rotation.set(0,7*s,0),i.scale.set(0,0,0);var o=.1+2*Math.random();i.scale.set(o,o,o)}tick(i){for(var{delta:a}=i,e=0;e<this.mixers.length;e++){this.mixers[e].update(a);var s=this.activeBlobs[e];if(s.position.y+=-.001,s.scale.x+=-5e-4,s.scale.y+=5e-4,s.scale.z+=-5e-4,this.mixers[e].animOver)if(s.position.y<=.1){if(s.position.y=0,this.mixers[e].animScaleCount+=1,1===this.mixers[e].animScaleCount){var t=s.scale.x,n=s.scale.y,o=s.scale.z;s.scale.set(1.5*t,.9*n,1.5*o)}if(s.scale.x+=.03,s.scale.z+=.03,s.scale.y>.5&&(s.scale.y-=.01),s.position.y+=-1e-4,this.mixers[e].animScaleCount>=200){var r=this.engine.animations;this.resetAnimClip(r,this.mixers[e],s)}}else s.position.y-=this.mixers[e].animPosYCount/6}}}export{s as default};
