import{a_ as i,aj as a,ai as t}from"../vendor.js";class e{constructor(i){var{artifact:a,mergeConfig:t}=i;this.artifact=a,this.config=t(a,{particleCount:4}),this.originalBlobs=[],this.activeBlobs=[],this.mixers=[]}beforeLoadModel(i){var a=this,{engine:e,preload:s}=i,{scene:n,animations:o}=s.assets.gltf;this.engine=e;n.traverse((i=>{if("icePoop_gr"===i.name)for(var e=function(e){var s=i.clone();s.randomDelayNum=20*Math.random(),s.userData.waitUntil=s.randomDelayNum;var n=new t(s);a.resetAnimClip(o,n,s),n.addEventListener("finished",(()=>{n.animOver=!0,n.animScaleCount=0,n.animPosYCount=1})),a.activeBlobs.push(s),a.engine.scene.add(s),a.mixers.push(n)},s=0;s<this.config.particleCount;s++)e()}))}resetAnimClip(t,e,s){var n=i.findByName(t,"Anim_0");e.clipAction(n).stop(),e.clipAction(n).play().startAt(s.userData.waitUntil),e.clipAction(n).clampWhenFinished=!0,e.clipAction(n).setLoop(a,1),e.animOver=!1,e.animScaleCount=0,e.animPosYCount=1,s.scale.set(0,0,0),this.resetBlobStartPositions(s),e.clipAction(n).play()}resetBlobStartPositions(i){var a=Math.random()>.5?1:-1,t=5*Math.random()*a,e=2*Math.random(),s=Math.random()>.5?1:-1,n=5*Math.random()*s;i.position.set(5*t,e,5*n),i.rotation.set(0,7*e,0),i.scale.set(0,0,0);var o=.1+2*Math.random();i.scale.set(o,o,o)}tick(i){for(var{delta:a}=i,t=0;t<this.mixers.length;t++){this.mixers[t].update(a);var e=this.activeBlobs[t];if(e.position.y+=-.001,e.scale.x+=-5e-4,e.scale.y+=5e-4,e.scale.z+=-5e-4,this.mixers[t].animOver)if(e.position.y<=.1){if(e.position.y=0,this.mixers[t].animScaleCount+=1,1===this.mixers[t].animScaleCount){var s=e.scale.x,n=e.scale.y,o=e.scale.z;e.scale.set(1.5*s,.9*n,1.5*o)}if(e.scale.x+=.03,e.scale.z+=.03,e.scale.y>.5&&(e.scale.y-=.01),e.position.y+=-1e-4,this.mixers[t].animScaleCount>=200){var r=this.engine.animations;this.resetAnimClip(r,this.mixers[t],e)}}else e.position.y-=this.mixers[t].animPosYCount/6}}}export{e as default};
