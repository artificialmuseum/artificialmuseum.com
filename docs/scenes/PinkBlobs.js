import{ac as a,ab as e,$ as t,aa as i}from"../vendor.js";class s{constructor(a){var{artifact:e,mergeConfig:t}=a;this.artifact=e,this.config=t(e,{particleCount:15,maxSpawnDistance:5,maxSpawnWaitTime:20}),this.originalBlobs=[],this.activeBlobs=[],this.mixers=[],this.eventsToRemove=[]}afterLoadModel(e){var s=this,{engine:o}=e;this.engine=o;for(var r=o.model.getObjectByName("icePoop"),n=a.findByName(o.animations,"Anim_0"),c=function(a){var e=r.clone(),o=e.children[0].children[0].material.clone();o.transparent=!0,e.traverse((a=>{a.isMesh&&(a.material=o)}));var c=new i(e),l=c.clipAction(n);l.clampWhenFinished=!0,e.userData.clip=l;var h=[c,"finished",()=>{c.animOver=!0}];t.on(...h),s.eventsToRemove.push(h),s.activeBlobs.push(e),s.engine.scene.add(e),s.mixers.push(c)},l=0;l<this.config.particleCount;l++)c();r.visible=!1}afterSpawnModel(){this.activeBlobs.forEach(((a,t)=>{var i=0===t?0:this.config.maxSpawnWaitTime;a.userData.clip.setLoop(e,1).startAt(Math.random()*i).play(),this.resetBlobStartPosition(a)}))}exit(){this.eventsToRemove.forEach((a=>{t.off(...a)}))}resetBlobStartPosition(a){var e=Math.random()>.5?1:-1,t=Math.random()*this.config.maxSpawnDistance*e,i=Math.random()>.5?1:-1,s=(1+Math.random()*this.config.maxSpawnDistance)*i;a.position.x=t,a.position.y=-.6,a.position.z=s,a.traverse((a=>{a.isMesh&&(a.material.opacity=1)}));var o=Math.floor(360*Math.random());a.rotation.set(0,o,0);var r=.03*Math.random()+.01;a.scale.set(r,r,r)}tick(a){for(var e=this,{delta:t}=a,i=function(a){var i=e.mixers[a];i.update(t);var s=e.activeBlobs[a];if(i.animOver){var o=s.children[0].children[0];if(s.scale.y>.1&&o.material.opacity>0){var r=s.scale.x+1e-4,n=Math.max(1e-6,s.scale.y-1e-4),c=s.scale.z+1e-4;s.scale.set(r,n,c),o.material.opacity>0&&s.traverse((a=>{a.isMesh&&(a.material.opacity-=.001)}))}else o.material.opacity>0?s.traverse((a=>{a.isMesh&&(a.material.opacity-=.001)})):(s.position.z=1e3,setTimeout((()=>{i.animOver=!1,i._actions.forEach((a=>{a.reset()})),e.resetBlobStartPosition(s)}),10))}},s=0;s<this.mixers.length;s++)i(s)}}export{s as default};
