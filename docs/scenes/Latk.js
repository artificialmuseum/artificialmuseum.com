import{c as r,aG as e,aD as a,aL as t,aX as s,aY as i,V as n,W as o}from"../vendor.js";class l{constructor(r){var{artifact:e}=r,a=[{mat:{color:16711680},pos:[0,0,0]}],{file:t=e.slug}=e,{fps:s=12,layers:i=a,reverse:n=!1}=e.latk;this.file=t;this.frameMsInterval=1e3/s,this.layers=i,this.reverse=n,this.longestLayer=-1,this.currentFrame=0}init(s){var i=this;return r((function*(){var{engine:r,preload:n}=s;n.assets.gltf?i.model=n.assets.gltf.scene:(i.model=new e,i.model.position.set(0,0,0)),i.renderer=r.renderer,i.camera=r.camera,i.scene=r.scene,i.buffer=new a,i.lineGroup=new t,i.model.add(i.lineGroup),i.layers.forEach((r=>{var e=i.createLayer(r);i.lineGroup.add(e)}))}))()}createLayer(r){var{mat:e,pos:a}=r,t=new s(e),o=new i(this.buffer,t);return o.frustumCulled=!1,a&&o.position.add(new n(...a)),o}preload(){var e=this;return r((function*(){var{latk:r}=yield import("".concat(o.STATIC_URL,"/latk/").concat(e.file,".js"));r.forEach((r=>{r.layers.forEach((r=>{r.frames.length>e.longestLayer&&(e.longestLayer=r.frames.length),r.frames.forEach((r=>{r.strokes.forEach((r=>{var a=r.points.map((r=>e.point2Vec(r)));r.points=a}))}))}))})),e.latk=r}))()}point2Vec(r){return r=Array.isArray(r)?r:r.co,this.reverse&&(r=r.reverse()),new n(...r)}tick(r){var{timestamp:e}=r,{latk:a}=this;if(a&&a.length&&(!this.lastTick||this.lastTick+this.frameMsInterval<=e)){var t=[];a.forEach((r=>{var{layers:e}=r;e.forEach((r=>{var{frames:e={}}=r,{strokes:a=[]}=e[this.currentFrame];a.forEach((r=>{var e=this.drawStroke(r);t.push(...e)}))}))})),this.buffer.setFromPoints(t),this.currentFrame+=1,this.lastTick=e,this.lineGroup.traverse((r=>{r.geometry=this.buffer}));var s=this.longestLayer-1;this.currentFrame>s&&(this.currentFrame=0)}}drawStroke(r){for(var e=[],a=0;a<r.points.length-1;a++)e.push(r.points[a]),e.push(r.points[a+1]);return e}}export{l as default};
