import{c as e,a5 as a,C as r,aG as t,ac as o,M as n,V as s,aT as i,aU as h,aZ as d}from"../vendor.js";class l{constructor(e){var{artifact:a}=e,{sphereCount:r=1e3,blackMolCount:t=100,whiteMolCount:o=100,parentCount:n=10,spawnCircleYOffset:s=.5,spawnCircleHeight:i=15,sphereScaleFactor:h=.1,spawnCircleDistance:d=2,spawnCircleWidth:l=5,upMolSpawnY:p=-7,molYSpeedMod:c=.02,upMolTargetPos:M=2.2}=a;this.sphereCount=r,this.whiteMolCount=o,this.blackMolCount=t,this.parentCount=n,this.spawnCircleYOffset=s,this.spawnCircleHeight=i,this.sphereScaleFactor=h,this.spawnCircleDistance=d,this.spawnCircleWidth=l,this.upMolSpawnY=p,this.molYSpeedMod=c,this.upMolTargetPos=M,this.spawnCircleParents=[],this.upCircleParents=[],this.parentVelocities=[],this.rotators=[],this.upMols=[]}init(o){var n=this;return e((function*(){var{preload:e}=o;n.sphereMaterials=[new a({color:new r(0)}),new a({color:new r(16777215)})];var s=[15134221,3210255,12860729,16777173,16712446,8230640,15603985,458740,16340742,4709478,3543287,15689147];s.forEach((e=>{var t=new a({color:new r(e)});n.sphereMaterials.push(t)}));for(var i=function(e){s.forEach((t=>{var o=new a({color:new r(t),transparent:!0,opacity:e+.2+.2});n.sphereMaterials.push(o)}))},h=0;h<5;h++)i(h);n.model=e.assets.gltf.scene,n.portal=n.model.getObjectByName("portal"),n.portal.renderOrder=1;for(var{blackMolCount:d,parentCount:l,sphereCount:p,upMolSpawnY:c,whiteMolCount:M}=n,w=n.portal.position,m=0;m<l;m++){var C=new t;n.spawnCircleParents.push(C),C.position.set(w.x,0,w.z),C.renderOrder=1,n.model.add(C);var u=C.clone();u.position.set(w.x,c,w.z),n.upCircleParents.push(u),u.renderOrder=1,n.model.add(u);var v=.002*Math.random()+.001;n.parentVelocities.push(v)}for(var f=0;f<p;f++){var P=n.createSphere(),{x:g,y:O,z:x}=n.getRandomCirclePosition();P.position.set(g,O,x);var S=f%n.spawnCircleParents.length;n.spawnCircleParents[S].add(P)}for(var Y=0;Y<M;Y++){var y=n.createWhiteMol(),{x:z,y:k,z:H}=n.getRandomCirclePosition();y.position.set(z,k,H);var R=Y%n.spawnCircleParents.length;n.spawnCircleParents[R].add(y)}for(var U=0;U<d;U++){var E=n.createBlackMol(),{x:W,y:V,z:b}=n.getRandomCirclePosition();E.position.set(W,V,b);var B=U%n.spawnCircleParents.length;n.spawnCircleParents[B].add(E)}for(var T=0;T<p/5;T++){var D=n.createSphere(),F=T%n.upCircleParents.length;n.upCircleParents[F].add(D),n.addUpMol(D)}for(var I=0;I<d/7;I++){var j=n.createBlackMol(),A=I%n.upCircleParents.length;n.upCircleParents[A].add(j),n.addUpMol(j)}for(var G=0;G<M/7;G++){var N=n.createWhiteMol(2),Z=G%n.upCircleParents.length;n.upCircleParents[Z].add(N),n.addUpMol(N)}}))()}getRandomCirclePosition(){var{spawnCircleDistance:e,spawnCircleWidth:a,spawnCircleHeight:r,spawnCircleYOffset:t}=this,o=Math.random()*a+e,n=360*Math.random(),s=o*Math.cos(n),i=o*Math.sin(n);return{x:s,y:Math.random()*(r/2)+t,z:i}}createSphere(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random()*this.sphereScaleFactor+.05,a=new o(e,32,16),r=Math.floor(30*Math.random()-.001),t=this.sphereMaterials[r],s=new n(a,t);return s.renderOrder=1,s}createBlackMol(){var e=new a({color:new r(0)}),d=new t;d.renderOrder=1;var l=new o(.5,64,64),p=new n(l,e),c=.1*Math.random()+.05;p.scale.set(c,c,c),p.renderOrder=1,d.add(p);for(var M=p.position,w=Math.round(5*Math.random()),m=0;m<=w;m++){var C=.7*(Math.random()-.5),u=.7*(Math.random()-.5),v=.7*(Math.random()-.5),f=new s(M.x+C,M.y+u,M.z+v),P=new n(l,e);P.renderOrder=1,P.position.set(f.x,f.y,f.z);var g=.1*Math.random()+.05;P.scale.set(g,g,g);var O=new i([M,f]),x=new h(O,2,.005,4),S=new n(x,e);S.renderOrder=1,d.add(S),d.add(P)}return this.addRotator(d),d}createWhiteMol(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,d=new a({color:new r(16777215)}),l=new o(.3,64,64),p=new t;p.renderOrder=1;var c=new n(l,d),M=.1*Math.random()+.05;c.scale.set(M,M,M),c.renderOrder=1,p.add(c);for(var w=Math.ceil(Math.random()*e),m=c.position,C=0;C<w;C++){var u=.5*(Math.random()-.5),v=.3*Math.random()+.1,f=.5*(Math.random()-.5),P=new s(m.x+u,m.y+v,m.z+f),g=new n(l,d);g.renderOrder=1,g.position.set(P.x,P.y,P.z);var O=.1*Math.random()+.05;g.scale.set(O,O,O);var x=new i([m,P]),S=new h(x,2,.005,4),Y=new n(S,d);Y.renderOrder=1,p.add(Y),p.add(g),m=P}p.position.set(3*Math.random(),3*Math.random(),3*Math.random());var y=360*Math.random()*(Math.PI/180),z=360*Math.random()*(Math.PI/180),k=360*Math.random()*(Math.PI/180);return p.rotation.set(y,z,k),this.addRotator(p),p}addRotator(e){this.rotators.push({mesh:e,speed:.01*Math.random(),axis:new s(Math.random(),Math.random(),Math.random())})}addUpMol(e){var{upMolTargetPos:a}=this,r={mesh:e,speed:Math.random()*this.molYSpeedMod,target:new s(Math.random()*a-a/2,this.spawnCircleHeight,Math.random()*a-a/2)};this.upMols.push(r)}repositionUpMol(e){var a=e.parent.position;e.position.set(a.x,a.y,0)}tick(){this.spawnCircleParents.forEach(((e,a)=>{e.rotateY(this.parentVelocities[a])})),this.upCircleParents.forEach(((e,a)=>{e.rotateY(5*this.parentVelocities[a])})),this.rotators.forEach((e=>{e.mesh.rotateOnAxis(e.axis,e.speed)})),this.upMols.forEach((e=>{var{mesh:a,speed:r,target:t}=e;if(a.position.y<this.spawnCircleHeight){var o=a.position.y+r,n=this.spawnCircleHeight-this.upMolSpawnY-(this.spawnCircleHeight-o),{x:i,z:h}=d(new s(0,this.upMolSpawnY,0),t,n);a.position.set(i,o,h)}else this.repositionUpMol(a),e.speed=Math.random()*this.molYSpeedMod}))}}export{l as default};
