import{U as e,p as t}from"../vendor.js";class i{constructor(e){var t,{artifact:i,mergeConfig:a,preload:s}=e;this.artifact=i,this.preload=s,this.hasClickables=(null===(t=i.clickables)||void 0===t?void 0:t.length)>0,this.config=a(i.ply,{fadeSpeed:1,targetName:"target_"}),this.currentPly=!1}afterLoadModel(e){var{engine:t,preload:i}=e;this.engine=t,this.audioElements=i.assets.audioElements,this.points=t.model.getObjectByName("plyGroup"),this.points.children.forEach((e=>{var i="".concat(this.config.targetName).concat(e.geometry.name),a=t.model.getObjectByName(i);if(a){var{x:s,y:o,z:l}=a.position;e.position.set(s,o,l);var{x:r,y:n,z:c}=a.rotation;e.rotation.set(r,n,c);var{x:m,y:h,z:d}=a.scale;e.scale.set(m,h,d)}this.hasClickables&&(e.material.transparent=!0,e.material.opacity=0,e.visible=!1)}))}onTouch(e){e.forEach((e=>{var{node:t}=e,i=t.name.split("_").pop(),a=this.points.children.find((e=>e.geometry.name===i));this.currentPly!==a&&(this.currentPly=a)}))}tick(i){var{delta:a}=i;if(this.engine.modelSpawned&&this.hasClickables){var s=this.config.fadeSpeed*a;this.points.children.forEach(((i,a)=>{var o,l,{material:r}=i;if(null!==(o=this.audioElements)&&void 0!==o&&o.length){var{ele:n}=this.audioElements.find((e=>e.config.audio===i.geometry.name));l=n}if(this.currentPly!==i){if(r.opacity>0?r.opacity-=1.3*s:i.visible&&(i.visible=!1),l)if(!e&&l.volume>0){var c=Math.max(0,l.volume-1.3*s);t.fn(l.setVolume)?l.setVolume(c):l.volume=c}else l.pause(),l.currentTime=0}else if(i.visible||(i.visible=!0),r.opacity<1&&(r.opacity+=.8*s),l&&(l.paused&&l.play(),!e&&l.volume<1)){var m=Math.min(1,l.volume+.8*s);t.fn(l.setVolume)?l.setVolume(m):l.volume=m}}))}}}export{i as default};
